% Preamble file containing all package configurations and custom settings

% Basic packages
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{lmodern}  % Latin Modern fonts
\usepackage{microtype}
\usepackage{amsmath,amssymb,amsthm,amsfonts}
\usepackage{mathtools}
\usepackage{physics}
\usepackage{bm}  % Bold math symbols
\usepackage{graphicx}
\usepackage{xcolor}
\usepackage{hyperref}
\usepackage{bookmark}
% \usepackage[framemethod=tikz]{mdframed}
\usepackage{thmtools}
\usepackage{thm-restate}
\usepackage{enumitem}
\usepackage{multicol}
\usepackage{tabularx}
\usepackage{booktabs}
\usepackage{caption}
\usepackage{subcaption}
\usepackage{tikz}
\usepackage{pgfplots}
\usepackage{algorithm2e}
\usepackage{algorithm}
\usepackage{algpseudocode}
\usepackage{algorithmicx}
\usepackage{listings}
\usepackage{fancyhdr}
\usepackage[]{geometry}
\usepackage[backend=biber, style=alphabetic]{biblatex}
\usepackage{csquotes}
\usepackage{makeidx}
\usepackage{minted}
\usepackage{titlesec}
\usepackage{titletoc}
\usepackage{etoolbox}
\usepackage{xparse}
\usepackage{marginnote}
\usepackage{sidenotes}
\usepackage{tcolorbox}

% Define colors
\definecolor{DarkSkyBlue}{RGB}{0, 51, 153}
\definecolor{LightGray}{RGB}{240, 240, 240}
\definecolor{DarkGray}{RGB}{64, 64, 64}
\definecolor{TheoremBlue}{RGB}{230, 236, 245}
\definecolor{LemmaGreen}{RGB}{230, 245, 230}
\definecolor{PropositionYellow}{RGB}{245, 245, 230}
\definecolor{DefinitionPurple}{RGB}{240, 230, 245}
\definecolor{ExampleGray}{RGB}{240, 240, 240}
\definecolor{CodeBackground}{RGB}{248, 248, 248}
\definecolor{CodeComment}{RGB}{0, 128, 0}
\definecolor{CodeKeyword}{RGB}{0, 0, 255}
\definecolor{CodeString}{RGB}{163, 21, 21}

% Page geometry
\geometry{
    paper=a4paper,
    inner=2.5cm,
    outer=2.5cm,
    top=2.5cm,
    bottom=2.5cm,
    marginparwidth=2cm,
    marginparsep=0.5cm,
    headsep=1cm,
    footskip=1cm
}

% Fix the headheight warning
\setlength{\headheight}{26pt}

% Set line spacing
\renewcommand{\baselinestretch}{1.3}

% Configure hyperref
\hypersetup{
    colorlinks=true,
    linkcolor=DarkSkyBlue,
    citecolor=DarkSkyBlue,
    urlcolor=DarkSkyBlue,
    pdfauthor={Author Name},
    pdftitle={Elder, the Arcane Realization},
    pdfsubject={Mathematical Text},
    pdfkeywords={mathematics, arcane, realization}
}

% Configure listings for code
\lstset{
    basicstyle=\ttfamily\small,
    backgroundcolor=\color{CodeBackground},
    keywordstyle=\color{CodeKeyword},
    commentstyle=\color{CodeComment},
    stringstyle=\color{CodeString},
    numbers=left,
    numberstyle=\tiny\color{DarkGray},
    numbersep=5pt,
    frame=single,
    framesep=5pt,
    breaklines=true,
    breakatwhitespace=true,
    showstringspaces=false,
    tabsize=4
}

% GoLang language definition for listings
\lstdefinelanguage{golang}{
  keywords={break, default, func, interface, select, case, defer, go, map, struct, chan, else, goto, package, switch, const, fallthrough, if, range, type, continue, for, import, return, var},
  sensitive=true,
  morecomment=[l]{//},
  morecomment=[s]{/*}{*/},
  morestring=[b]",
  morestring=[b]',
  morestring=[b]`
}

% C++ language definition for listings
\lstdefinelanguage{C++}{
  keywords={alignas, alignof, and, and_eq, asm, atomic_cancel, atomic_commit, atomic_noexcept, auto, bitand, bitor, bool, break, case, catch, char, char8_t, char16_t, char32_t, class, compl, concept, const, consteval, constexpr, constinit, const_cast, continue, co_await, co_return, co_yield, decltype, default, delete, do, double, dynamic_cast, else, enum, explicit, export, extern, false, float, for, friend, goto, if, inline, int, long, mutable, namespace, new, noexcept, not, not_eq, nullptr, operator, or, or_eq, private, protected, public, reflexpr, register, reinterpret_cast, requires, return, short, signed, sizeof, static, static_assert, static_cast, struct, switch, synchronized, template, this, thread_local, throw, true, try, typedef, typeid, typename, union, unsigned, using, virtual, void, volatile, wchar_t, while, xor, xor_eq},
  sensitive=true,
  morecomment=[l]{//},
  morecomment=[s]{/*}{*/},
  morestring=[b]",
  morestring=[b]',
  otherkeywords={<, >, [, ], (, ), \{, \}, =, ==, !=, <=, >=, +, -, *, /, &, |, ^, ~, :, ;, %, ? },
  morekeywords={complex, float, ParallelFor, AllocateDeviceMemory, HermitianOuterProduct, ComplexMatrixMultiply, ComplexActivation, SumMatrices}
}

% Configure algorithm2e
\SetAlgorithmName{Algorithm}{Algorithm}{List of Algorithms}
\SetAlgoCaptionLayout{smallcaption}
\SetAlgoNoLine
\SetAlgoNoEnd
\SetArgSty{textnormal}
\SetDataSty{textsf}
\SetFuncSty{texttt}
\SetKwSty{textbf}
\SetKwInOut{Input}{Input}
\SetKwInOut{Output}{Output}

% TikZ and PGFPlots configuration
\pgfplotsset{compat=1.18}
\usetikzlibrary{
    arrows,
    automata,
    backgrounds,
    calc,
    decorations.pathmorphing,
    decorations.pathreplacing,
    fit,
    matrix,
    patterns,
    positioning,
    shapes.geometric,
    shapes.misc
}

% Bibliography file
\addbibresource{bibliography.bib}

% Set up index
\makeindex

% Load custom macro files
\input{macros/math_macros}
\input{macros/theorem_styles}

% Load custom style files
\input{styles/chapter_style}
\input{styles/layout_style}

% Define the two-column layout
\newenvironment{twocolumns}
{\begin{multicols}{2}}
{\end{multicols}}

% Create custom chapter display with margin numbers
\titleformat{\chapter}[display]
{\normalfont\huge\bfseries}
{\filleft\begin{minipage}{5cm}
\flushright{\fontsize{80}{80}\color{DarkSkyBlue}\selectfont\thechapter}
\end{minipage}}
{20pt}
{\titlerule\vspace{10pt}\filright}
[\vspace{10pt}]

% Custom section styling - ensure titles fit within column width in two-column layout
\titleformat{\section}
{\normalfont\Large\bfseries\color{DarkSkyBlue}}
{\thesection}{1em}{}[\vspace{0.5em}]

\titleformat{\subsection}
{\normalfont\large\bfseries}
{\thesubsection}{1em}{}[\vspace{0.3em}]

\titleformat{\subsubsection}
{\normalfont\normalsize\bfseries}
{\thesubsubsection}{1em}{}[\vspace{0.2em}]

% Adjust section title spacing to prevent overhang in two-column layout
\titlespacing*{\section}{0pt}{3.5ex plus 1ex minus .2ex}{2.3ex plus .2ex}
\titlespacing*{\subsection}{0pt}{3.25ex plus 1ex minus .2ex}{1.5ex plus .2ex}
\titlespacing*{\subsubsection}{0pt}{3.25ex plus 1ex minus .2ex}{1.5ex plus .2ex}

% Header and footer setup
\pagestyle{fancy}
\fancyhf{}
\fancyhead[LE,RO]{\thepage}
\fancyhead[RE]{\textit{\leftmark}}
\fancyhead[LO]{\textit{\rightmark}}
\renewcommand{\headrulewidth}{0.5pt}
\renewcommand{\footrulewidth}{0pt}

% Special pages style
\fancypagestyle{plain}{
    \fancyhf{}
    \fancyfoot[C]{\thepage}
    \renewcommand{\headrulewidth}{0pt}
    \renewcommand{\footrulewidth}{0pt}
}

% Custom list of theorems
\newcommand{\listofelderthms}{
    \chapter*{List of Theorems}
    \markboth{LIST OF THEOREMS}{LIST OF THEOREMS}
    \addcontentsline{toc}{chapter}{List of Theorems}
    \begingroup
    \let\clearpage\relax
    \listoftheorems[ignoreall,show={theorem}]
    \endgroup
}
